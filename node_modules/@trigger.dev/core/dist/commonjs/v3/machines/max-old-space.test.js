"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vitest_1 = require("vitest");
const index_js_1 = require("./index.js");
(0, vitest_1.describe)("nodeOptionsWithMaxOldSpaceSize", () => {
    const testMachine = {
        name: "small-2x",
        memory: 1, // 1GB = 1024 MiB
        cpu: 1,
        centsPerMs: 0,
    };
    // With default 0.2 overhead, max-old-space-size should be 819 (1024 * 0.8)
    const expectedFlag = "--max-old-space-size=819";
    (0, vitest_1.it)("handles undefined NODE_OPTIONS", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)(undefined, testMachine);
        (0, vitest_1.expect)(result).toBe(expectedFlag);
    });
    (0, vitest_1.it)("handles empty string NODE_OPTIONS", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)("", testMachine);
        (0, vitest_1.expect)(result).toBe(expectedFlag);
    });
    (0, vitest_1.it)("preserves existing flags while adding max-old-space-size", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)("--inspect --trace-warnings", testMachine);
        (0, vitest_1.expect)(result).toBe(`--inspect --trace-warnings ${expectedFlag}`);
    });
    (0, vitest_1.it)("replaces existing max-old-space-size flag", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)("--max-old-space-size=4096 --inspect", testMachine);
        (0, vitest_1.expect)(result).toBe(`--inspect ${expectedFlag}`);
    });
    (0, vitest_1.it)("handles multiple existing max-old-space-size flags", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)("--max-old-space-size=4096 --inspect --max-old-space-size=8192", testMachine);
        (0, vitest_1.expect)(result).toBe(`--inspect ${expectedFlag}`);
    });
    (0, vitest_1.it)("handles extra spaces between flags", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)("--inspect    --trace-warnings", testMachine);
        (0, vitest_1.expect)(result).toBe(`--inspect --trace-warnings ${expectedFlag}`);
    });
    (0, vitest_1.it)("uses custom overhead value", () => {
        const result = (0, index_js_1.nodeOptionsWithMaxOldSpaceSize)("--inspect", testMachine, 0.5);
        // With 0.5 overhead, max-old-space-size should be 512 (1024 * 0.5)
        (0, vitest_1.expect)(result).toBe("--inspect --max-old-space-size=512");
    });
});
//# sourceMappingURL=max-old-space.test.js.map